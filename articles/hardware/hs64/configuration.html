<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Headstage64 Configuration </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Headstage64 Configuration ">
      
      
      <link rel="icon" href="../../../favicon.png">
      <link rel="stylesheet" href="../../../public/docfx.min.css">
      <link rel="stylesheet" href="../../../public/main.css">
      <meta name="docfx:navrel" content="../../../toc.html">
      <meta name="docfx:tocrel" content="../../toc.html">
      
      <meta name="docfx:rel" content="../../../">
      
      
      <meta name="docfx:docurl" content="https://github.com/open-ephys/bonsai-onix1-docs/blob/main/articles/hardware/hs64/configuration.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../../index.html">
            <img id="logo" class="svg" src="../../../logo.svg" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled="" placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="hs64_configuration">
          <h1>Headstage64 Configuration</h1>

  <p>
    The following excerpt from the Headstage64 <a class="xref" href="workflow.html">
    example workflow</a> demonstrates how to create an ONIX acquisition context using <a class="xref" href="../../../api/OpenEphys.Onix1.CreateContext.html">CreateContext</a>, configures a Headstage64
    using <a class="xref" href="../../../api/OpenEphys.Onix1.ConfigureHeadstage64.html">ConfigureHeadstage64</a>, and
    then starts acquisition using <a class="xref" href="../../../api/OpenEphys.Onix1.StartAcquisition.html">StartAcquisition</a>.
  </p>

  <div class="workflow"> 
    <p><img src="../../../workflows/hardware/hs64/configuration.bonsai" alt="~/workflows/hardware/hs64/configuration.bonsai workflow"></p>
  </div>

  <div class="NOTE alert alert-info">
      <h5>NOTE</h5>
      <p>
          To learn more about the top-level configuration motif in every workflow involving
          ONIX hardware, visit the <a class="xref" href="../../getting-started/initialize-oni-context.html">Configuration Chain
          Tutorial</a>.
      </p>
  </div>

  <h2>Creating an Acquisition Context</h2>

  <p>
    The <a class="xref" href="../../../api/OpenEphys.Onix1.CreateContext.html">CreateContext</a> operator
    creates a <a class="xref" href="../../../api/OpenEphys.Onix1.ContextTask.html">ContextTask</a> that
    defines the device driver and index where the hardware exists. The
    <code>Driver</code> property is set to "riffa", which is the name of the PCIe device used by ONIX.
    In this case, the <code>Index</code> property is set to 0 because there is only a single ONIX system. 
    If a second system is used on the same computer, a second <code>CreateContext</code> operator
    would be required in its own configuration chain, with its <code>Index</code> property set to 1.
  </p>

  <h2 id="configuring-the-breakout-board-and-headstage64">Configuring the Breakout Board and Headstage64</h2>
<p>The <code>ConfigureBreakoutBoard</code> operator configures the Onix Breakout Board. In the Headstage64 example tutorial, it is configured to enable digital inputs to serve as a trigger for the Headstage64's electrical and optical stimulation and to enable monitoring of the percentage of memory occupied. This is accomplished by leaving all of the <code>ConfigureBreakoutBoard</code> properties set to their default values except its <code>Memory Monitor</code> <code>Enable</code> property is set to <code>True</code>.</p>
<p>The <code>ConfigureHeadstage64</code> operator is used to configure the Headstage64. In the Headstage64 example tutorial, it is configured to enable streaming of electrophysiology data from a Rhd2164 amplifier, orientation data from the on-board Bno055 IMU, and position data from the Ts4231. This is accomplished in the Headstage64 example workflow by leaving all of the <code>ConfigureHeadstage64</code> properties set to their default values.</p>
<p>When the workflow is started, the current time (based on
<a href="https://en.wikipedia.org/wiki/Coordinated_Universal_Time">Coordinated Universal Time</a>)
is saved, along with global hardware parameters governing data acquisition. This is
accomplished using a <a href="https://bonsai-rx.org/docs/api/Bonsai.Reactive.Timestamp.html">TimeStamp</a> operator
to capture the computer's wall clock time. This
<code>Timestamp</code> is saved along with <code>ContextTask</code>'s properties (e.g.,
<code>AcquisitionClockHz</code>, <code>BlockReadSize</code>, <code>BlockWriteSize</code>) to a csv
file (<code>start-time_&lt;timestamp&gt;.csv</code>) when the the workflow is started.</p>


  <h2>Starting Acquisition</h2>

  <p>
    After starting a workflow, the <a class="xref" href="../../../api/OpenEphys.Onix1.StartAcquisition.html">StartAcquisition</a>
    operator begins data acquisition with the hardware that has been configured. In the Headstage64
    example workflow, data is collected from the Headstage64 only, so the rate of data being
    produced by the hardware will be ~4.1 MB/s. The <code>StartAcquisition</code>'s <code>ReadSize</code> property is set to
  2048 bytes, meaning data collection will wait until
  2048 bytes of data have been produced by the hardware. At 4.1 MB/s the
    hardware will produce 2048 bytes every ~500 μs. This is a hard
    bound on the latency of the system. If lower latencies were required, the hardware would need to
    produce data more quickly or the <code>ReadSize</code> would need to be reduced. 
  </p>

  <p>The <code>StartAcquisition</code>'s <code>WriteSize</code> property is set to 2048 bytes. This
    determines the amount of memory that is preallocated for temporarily holding data before it is
    sent to hardware. It is less critical to performance unless the rate that data be written to the
    hardware is comparable to the rate that the hardware produces data, which is not a common scenario.
  </p>

  <div class="NOTE alert alert-info">
    <h5>NOTE</h5>
    <p>For an overview of the devices on the Headstage64 that can be configured through the <a class="xref" href="../../../api/OpenEphys.Onix1.ConfigureHeadstage64.html">ConfigureHeadstage64</a> operator, visit
    the <a class="xref" href="overview.html">Headstage64
    Overview</a>.</p>
  </div>


  
</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/open-ephys/bonsai-onix1-docs/blob/main/articles/hardware/hs64/configuration.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          &copy; 2024 Open Ephys and Contributors. Made with <a href="https://dotnet.github.io/docfx">docfx</a>
        </div>
      </div>
    </footer>
  </body>
</html>
